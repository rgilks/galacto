<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Black Hole Simulation - WebGPU</title>
    <meta
      name="description"
      content="A GPU-accelerated black hole accretion disk simulation featuring thousands of particles orbiting a central singularity. Built with Rust, WebAssembly, and WebGPU."
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  </head>
  <body>
    <!-- Loading screen -->
    <div id="loading" class="loading">
      <h2>Initializing Black Hole Simulation...</h2>
      <p>Loading WebGPU and compiling shaders...</p>
      <div class="loader"></div>
    </div>

    <!-- Error display -->
    <div id="error" class="loading error" style="display: none">
      <h2>WebGPU Not Supported</h2>
      <p>
        This simulation requires WebGPU support. Please ensure you're using a
        modern browser with WebGPU enabled:
      </p>
      <ul>
        <li><strong>Chrome/Edge:</strong> Version 113+ (should work by default)</li>
        <li><strong>Firefox:</strong> Enable <code>dom.webgpu.enabled</code> in about:config</li>
        <li><strong>Safari:</strong> WebGPU support may vary by version</li>
      </ul>
      <div id="error-details"></div>
    </div>

    <!-- Main canvas -->
    <canvas id="gpu-canvas"></canvas>

    <script type="module">
      async function checkWebGPUSupport() {
        if (!navigator.gpu) {
          throw new Error("WebGPU not supported in this browser");
        }
        const adapter = await navigator.gpu.requestAdapter();
        if (!adapter) {
          throw new Error("No WebGPU adapter found");
        }
        const device = await adapter.requestDevice();
        if (!device) {
          throw new Error("Failed to create WebGPU device");
        }
        return true;
      }

      async function init() {
        const loadingEl = document.getElementById("loading");
        const errorEl = document.getElementById("error");
        const errorDetailsEl = document.getElementById("error-details");

        try {
          await checkWebGPUSupport();
          const { default: init } = await import("./galaxy_sim.js");
          await init();
          loadingEl.style.display = "none";
        } catch (error) {
          console.error("Failed to initialize application:", error);
          loadingEl.style.display = "none";
          errorEl.style.display = "block";
          errorDetailsEl.innerHTML = `<p><strong>Error:</strong> ${error.message}</p>`;
        }
      }

      init().catch(console.error);
    </script>
  </body>
</html>
